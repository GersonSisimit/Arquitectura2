@{
    ViewData["Title"] = "Estacionamiento Dashboard";
}

<div class="container mt-5">
    <h1 class="text-center mb-4">Estacionamiento Inteligente</h1>

    <div class="row text-center mb-5">
        <!-- Tarjeta de Vehículos Estacionados -->
        <div class="col-md-4">
            <div class="card bg-primary text-white shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-car-side"></i> Vehículos Estacionados</h5>
                    <h2 id="estacionados" class="display-4">0</h2>
                </div>
            </div>
        </div>

        <!-- Tarjeta de Vehículos en Espera -->
        <div class="col-md-4">
            <div class="card bg-warning text-dark shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-clock"></i> Vehículos en Espera</h5>
                    <h2 id="enEspera" class="display-4">0</h2>
                </div>
            </div>
        </div>

        <!-- Tarjeta de Espacios Disponibles -->
        <div class="col-md-4">
            <div class="card bg-success text-white shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-parking"></i> Espacios Disponibles</h5>
                    <h2 id="disponibles" class="display-4">@ViewBag.CapacidadMaxima</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Controles de Ingreso y Salida de Vehículos -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="input-group">
                <input type="number" id="cantidadIngresar" class="form-control" placeholder="Cantidad de vehículos a ingresar" min="1" />
                <button class="btn btn-primary" onclick="ingresarVehiculos()">Ingresar</button>
            </div>
        </div>

        <div class="col-md-6">
            <div class="input-group">
                <input type="number" id="cantidadSacar" class="form-control" placeholder="Cantidad de vehículos a retirar" min="1" />
                <button class="btn btn-danger" onclick="sacarVehiculos()">Sacar</button>
            </div>
        </div>
    </div>

    <!-- Mensajes de Resultado -->
    <div class="mt-4" id="resultado"></div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<script>
    function ingresarVehiculos() {
        const cantidad = parseInt($('#cantidadIngresar').val());

        // Validar si el input es un número válido
        if (isNaN(cantidad) || cantidad <= 0) {
            mostrarResultado({ success: false, message: "La cantidad debe ser un número positivo." });
            return;
        }

        $.ajax({
            url: '@Url.Action("IngresarVehiculos", "Home")',
            type: 'POST',
            data: { cantidad: cantidad },
            success: function (response) {
                actualizarEstado(response);
            },
            error: function () {
                mostrarResultado({ success: false, message: 'Error al ingresar vehículos.' });
            }
        });
    }

    function sacarVehiculos() {
        const cantidad = parseInt($('#cantidadSacar').val());

        // Validar si el input es un número válido
        if (isNaN(cantidad) || cantidad <= 0) {
            mostrarResultado({ success: false, message: "La cantidad debe ser un número positivo." });
            return;
        }

        $.ajax({
            url: '@Url.Action("SacarVehiculos", "Home")',
            type: 'POST',
            data: { cantidad: cantidad },
            success: function (response) {
                actualizarEstado(response);
            },
            error: function () {
                mostrarResultado({ success: false, message: 'Error al sacar vehículos.' });
            }
        });
    }

    function actualizarEstado(response) {
        $('#estacionados').text(response.estacionados);
        $('#enEspera').text(response.enEspera);

        // Calcular espacios disponibles y evitar NaN
        const disponibles = Math.max(0, @ViewBag.CapacidadMaxima - response.estacionados);
        $('#disponibles').text(disponibles);

        // Animación simple de actualización con color
        $('#estacionados, #enEspera, #disponibles').fadeOut(100).fadeIn(500);
        mostrarResultado(response);
    }

    function mostrarResultado(response) {
        const color = response.success ? 'green' : 'red';
        $('#resultado').html(`<p style="color:${color}">${response.message}</p>`);
    }
</script>
